function secs = waitTrigger(Situation, Windows)% Function waits for trigger from Princeton scanner (before display starts) % Trigger is an optic fiber signal, converted to TTL pulse, which is  % sent to to Rowland response box and converted to a keypress = '!'.% WaitTrigger also preloads functions: getChar, charAvail, getTicks, getSecs, PeekBlanking  % to prevent later timing delays with PlayMovie3T functions.%% created by Frank Tong on 2002/07/14, and modified by Janneke Jehee on% 2007/7/26if nargin < 2, Windows = false; endif nargin < 1, Situation = 0; endwhen = GetSecs;			% initialize function getSecsif ~Windows, when = GetTicks; enddisp('To begin experiment, start EPI scan with TRIGGER');%If we're in the scanner, we should wait specifically for a 5 (scanner trigger). %If not, we should wait for any keypress by the subject.FlushEvents('keyDown');key = ' ';if Situation == 1    if Windows           while ~strcmp(key(1), '5')            [keyIsDown, secs, keyCode] = KbCheck(-3);            if keyIsDown                key = find(keyCode);                    key = KbName(key);            end        end       else           while key ~= '5'            if(CharAvail)                [key when] = GetChar;									            end            secs = GetSecs;        end    endelse    secs = KbWait([],2);    end